webpackJsonp([2],{"0UOj":function(t,e){},JoZY:function(t,e){},h8CZ:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={data:function(){return{axios:i("mtWM"),img:[],videourl:"",file:[]}},created:function(){},methods:{removeimg:function(t,e){this.img.splice(t,1),this.axios.post("/files/delete",{fileUrl:e}).then(function(t){console.log(t.data.message)}).catch(function(t){console.log(t)})},getFile:function(t){var e=this;if(this.file=[],this.file.push.apply(this.file,t.target.files),t.target.value="",!(this.file.length<1)){if(this.img.length>8)return this.tooltip.ToastMsg("最多上传9张图片");var i=!0,o=[].slice.call(this.file,0),s=new RegExp(".(gif|jpg|jpeg|png|GIF|JPG|PNG)$");new RegExp(".(mp4)$");o.forEach(function(t){return t.size>3145728?(i=!1,e.tooltip.Toast.Error("图片不能超过3M")):s.test(t.name.toLowerCase())?void 0:(i=!1,e.tooltip.Toast.Error("不支持此图片类型(⊙o⊙)…"))}),i&&this.submitForm(t)}},submitForm:function(t){var e=this;t.preventDefault();var i=new FormData;[].slice.call(this.file,0).forEach(function(t){i.append("file",t)});this.tooltip.Loading.start("上传中"),this.axios.post("/files/upload",i,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){200===t.status?(e.tooltip.Loading.end(),e.img.push.apply(e.img,t.data.data),e.$emit("setimgUrl",e.img)):(e.tooltip.Loading.end(),e.tooltip.Toast.Error(t.data.message))}).catch(function(t){e.tooltip.Toast.Error(t)})}}},s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"upfile"},[i("div",{staticClass:"attach"},[t._l(t.img,function(e,o){return i("div",{staticClass:"upload"},[i("i",{staticClass:"remove",on:{click:function(i){t.removeimg(o,e)}}},[t._v("")]),t._v(" "),i("img",{attrs:{src:"http://localhost:3000/"+e,alt:""}})])}),t._v(" "),i("div",{staticClass:"upload"},[i("div",[i("i",[t._v("")]),i("p",[t._v("添加图片")]),t._v(" "),i("input",{attrs:{type:"file",name:"img",multiple:"multiple",accept:"image/*|video/*"},on:{change:function(e){t.getFile(e)}}})])])],2)])},staticRenderFns:[]};var a={data:function(){return{axios:i("mtWM"),content:"",img:[],videourl:"",userid:"",file:[]}},components:{uploadFile:i("VU/8")(o,s,!1,function(t){i("0UOj")},"data-v-0ecd1856",null).exports},created:function(){var t=this.User.getUserInfo();if(this.Userinfo=t,!t||!t._id)return this.tooltip.Toast.Error("请先登录",800),this.$router.replace({path:"/login"});this.userid=t._id},methods:{setimgUrl:function(t){this.img=t},submit:function(){var t=this;if(""==this.content)return this.tooltip.ToastMsg("写点什么吧 Ծ‸ Ծ"),this.$refs.textarea.focus();var e={uid:this.userid,videourl:this.videourl,img:this.img,content:this.content};this.$http.post("/article/publish",e,function(e){"0"===e.code?(t.tooltip.Toast.Success(e.message),t.$router.push({path:"/Home"})):t.tooltip.Toast.Error(e.message)},function(e){t.tooltip.Toast.Error(e),console.log(e)})}}},n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"publish iconfont"},[i("div",{staticClass:"text"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],ref:"textarea",attrs:{placeholder:"写点什么吧 Ծ‸ Ծ"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}})]),t._v(" "),i("upload-file",{on:{setimgUrl:t.setimgUrl}}),t._v(" "),i("div",{staticClass:"submit"},[i("a",{on:{click:t.submit}},[t._v("确认发布")])])],1)},staticRenderFns:[]};var r=i("VU/8")(a,n,!1,function(t){i("JoZY")},"data-v-0e8e848c",null);e.default=r.exports}});